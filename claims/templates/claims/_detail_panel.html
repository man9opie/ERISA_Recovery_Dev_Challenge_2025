{# claims/templates/claims/_detail_panel.html #}
{% load humanize tz %}

<div class="detail-layout">
  {# -------- 左侧：详情卡片 -------- #}
  <section class="detail-card">
    <header>
      <div class="detail-title">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <span>Claim Details - {{ claiam.claim_id }}</span>
      </div>

      {# 状态胶囊 #}
      {% with s=claim.status %}
        <span class="status-pill {% if s == 'denied' %}denied{% elif s == 'paid' %}paid{% else %}under_review{% endif %}">
          {% if s == 'denied' %}Denied{% elif s == 'paid' %}Paid{% else %}Under Review{% endif %}
        </span>
      {% endwith %}
    </header>

    <div class="detail-grid">
      <div class="stat">
        <div class="label">Patient:</div>
        <div class="value">{{ claim.patient_name }}</div>
      </div>
      <div class="stat">
        <div class="label">Discharge Date:</div>
        <div class="value">
          {% if claim.discharge_date %}{{ claim.discharge_date|date:"m/d/Y" }}{% else %}—{% endif %}
        </div>
      </div>
      <div class="stat">
        <div class="label">Billed Amount:</div>
        <div class="value">${{ claim.billed_amount|floatformat:2|intcomma }}</div>
      </div>
      <div class="stat">
        <div class="label">Paid Amount:</div>
        <div class="value">${{ claim.paid_amount|floatformat:2|intcomma }}</div>
      </div>
    </div>

    {# Insurer #}
    <div class="center-line">
      <span class="label">Insurer:</span>
      <span>{{ insurer_display|default:"—" }}</span>
    </div>

    {# CPT chips（有才显示） #}
    {% if cpt_list %}
      <div class="center-line">
        <div class="label">CPT:</div>
        <div class="chips">
          {% for code in cpt_list %}
            <span class="chip">{{ code }}</span>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {# Denial（只在有值时显示） #}
    {% if denial_text %}
      <div class="center-line">
        <span class="label">Denial:</span>
        <span class="denial-text">{{ denial_text }}</span>
      </div>
    {% endif %}
  </section>

  {# -------- 右侧：Notes 卡片 -------- #}
  <aside>
    {% include "claims/_notes_card.html" with claim=claim %}
  </aside>
</div>
