{% load humanize %}

<div class="detail-layout">
  <!-- å·¦ä¾§ï¼šClaim è¯¦æƒ…å¡ç‰‡ -->
  <article class="detail-card">
    <header>
      <div class="detail-title">
        <span>ğŸ“„</span>
        <span>Claim Details - {{ claim.claim_id }}</span>
      </div>
      <span class="status-pill {{ claim.status }}">{{ claim.get_status_display }}</span>
    </header>

    <!-- ä¸¤åˆ—å…³é”®ä¿¡æ¯ -->
    <div class="detail-grid">
      <!-- å·¦åˆ— -->
      <div>
        <p class="stat">
          <span class="label">Patient:</span><br>
          <b>{{ claim.patient_name }}</b>
        </p>
        <p class="stat">
          <span class="label">Billed Amount:</span><br>
          <span class="value">${{ claim.billed_amount|floatformat:2|intcomma }}</span>
        </p>
        {% comment %} CPT ç§»åˆ°å±…ä¸­è¡Œï¼Œè¿™é‡Œä¸å†æ˜¾ç¤º {% endcomment %}
      </div>

      <!-- å³åˆ— -->
      <div>
        <p class="stat">
          <span class="label">Discharge Date:</span><br>
          <b>{{ claim.discharge_date|date:"m/d/Y" }}</b>
        </p>
        <p class="stat">
          <span class="label">Paid Amount:</span><br>
          <span class="value">${{ claim.paid_amount|floatformat:2|intcomma }}</span>
        </p>
      </div>
    </div>

    <!-- å±…ä¸­ï¼šInsurer ä¸ CPT Codes åŒä¸€è¡Œ -->
    <!-- å±…ä¸­ï¼šInsurer å•ç‹¬ä¸€è¡Œ -->
    <div class="center-line">
      <span class="label">Insurer:</span>
      <b>{{ claim.insurer|default:"â€”" }}</b>
    </div>

    <!-- å±…ä¸­ï¼šCPT å•ç‹¬ä¸€è¡Œ -->
    <div class="center-line">
      <span class="label">CPT:</span>
      <div class="chips">
        {% for code in claim.cpt_codes %}
          <span class="chip">{{ code }}</span>
        {% empty %}
          <span class="chip">â€”</span>
        {% endfor %}
      </div>
    </div>


   {% if claim.status == 'denied' and claim.denial_reason %}
      <p class="stat denial-block" style="margin-top: 1.75rem;">
        <span class="label">Denial Reason:</span><br>
        <span class="denial-text">{{ claim.denial_reason }}</span>
      </p>
    {% endif %}


  </article>

  <!-- å³ä¾§ï¼šNotes å¡ç‰‡ -->
  <article class="notes-card" id="notes-card">
    <header><strong>Notes &amp; Annotations</strong></header>

    <!-- åˆ—è¡¨ï¼ˆå†…éƒ¨æ»šåŠ¨ï¼‰ -->
    <div id="notes-list" class="notes-list">
      {% include "claims/_notes_list.html" with claim=claim %}
    </div>

    <!-- æäº¤åæ•´ä½“æ›¿æ¢å¡ç‰‡ï¼šæˆåŠŸæ¸…ç©ºè¡¨å•ï¼Œå¤±è´¥æ˜¾ç¤ºé”™è¯¯ -->
    <form hx-post="{% url 'claims:add_note' claim.pk %}"
          hx-target="#notes-card" hx-swap="outerHTML"
          style="margin-top:.75rem">
      {% csrf_token %}

      <label>Note</label>
      {{ note_form.body }}
      {% if note_form.body.errors %}
        <small style="color:#c1121f">{{ note_form.body.errors|striptags }}</small>
      {% endif %}

      <div class="grid" style="align-items:end">
        <div>
          <label>Name</label>
          {{ note_form.author_name }}
          {% if note_form.author_name.errors %}
            <small style="color:#c1121f">{{ note_form.author_name.errors|striptags }}</small>
          {% endif %}
        </div>
        <div class="align-right">
          <button type="submit">Add Note</button>
        </div>
      </div>
    </form>
  </article>
</div>
